# Common APIs - Responsive Images

## Learning Objectives

Upon completion of this lesson the participant will be able to:

1. Explain what responsive images are and how they work
2. Describe how the WordPress Responsive Images API works when adding images from the media library
3. Customize the responsive images markup

## Outline

1. Introduction
2. What are responsive images?
3. The WordPress Responsive Images API
4. New functions and hooks
5. Customizing the responsive images markup

## Introduction

Hey there, and welcome to Learn WordPress. 

In this tutorial, you're going to learn about the WordPress Responsive Images API.

You will learn what responsive images are and why you should use them, how the WordPress Responsive Images API works, and how to customize the responsive images markup if you need to.

## What are responsive images?

[Responsive images](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images) are images that can adapt to the screen size of the device they are being viewed on. This is important because it means that the image will always look good, no matter what device it is being viewed on.

Let's take a look at an example: https://mdn.github.io/learning-area/html/multimedia-and-embedding/responsive-images/not-responsive.html

Most modern browsers have a special mode for viewing web page layouts on mobile devices. In Chrome based browsers it's called Device mode, and in Firefox and Safari it's called Responsive Design Mode. You can usually access this from the browser's developer tools. Once you enable this mode, you can see what a web page looks like on different devices.

If you look at the header image in this example, you can see that it gets cropped when you view it on a mobile device. However, the image in the content area does not, it merely shows the image at a smaller size. 

So what you might want is to be able to show a cropped version of that image on mobile devices, and the full image on desktop devices. This is where responsive images come in.

https://mdn.github.io/learning-area/html/multimedia-and-embedding/responsive-images/responsive.html

While the knowledge of how responsive images works is outside the scope of this tutorial, you can read more about how to implement responsive images in the [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images).

## The WordPress Responsive Images API

Since WordPress 4.4, responsive images is supported natively in WordPress by including srcset and sizes attributes to the image markup generated by the wp_get_attachment_image() [function](https://developer.wordpress.org/reference/functions/wp_get_attachment_image/). This means that it's on by default, and any images WordPress generates will automatically be responsive.

To understand how it works, let's look at a simple example. 

To start, add an image to the media library in your WordPress site. 

If you then browse to the uploads' directory, and take a look at where the image is stored, you will see that there are multiple versions of the image. 

This is because WordPress automatically generates multiple versions of the image in different sizes, which can then be used in different contexts.

Before responsive images, developers would attempt to dynamically serve different images to browsers based on the device type. The server would check what device size is being used, and then serve the appropriate image. 

This would have been possible by using the [User Agent](https://www.codexworld.com/mobile-device-detection-in-php/) string, which is a string that is sent by the browser to the server, and contains information about the browser and device being used.

```php
// check the $_SERVER["HTTP_USER_AGENT"] variable to see if this is a mobile device request
$isMob = is_numeric(strpos(strtolower($_SERVER["HTTP_USER_AGENT"]), "mobile")); 
 
if($isMob){ 
    echo 'Using Mobile Device...'; 
}else{ 
    echo 'Using Desktop...'; 
}
```

However, this makes testing difficult, as you need to either test on physical devices, use a service like [BrowserStack](https://www.browserstack.com/), or set up the user agent string in your testing environment.

Responsive design uses things like media queries to allow a single page to be rendered that will respond in the browser based on things like viewport width and display density. Responsive images follows this strategy and sends all of the information to the browser up front and lets the browser take care of loading the appropriate image rather than making those decisions on the server before the page is loaded.

Let's see this in action by adding your image to a post, and setting it's size to full size in the editor.

When you preview the image, you'll see that the image tag contains more than just the image url

```html
<img decoding="async" width="2048" height="1605" src="https://learnpress.test/wp-content/uploads/2023/07/4831876143_be927a496c_o.jpeg" alt="" class="wp-image-22" srcset="https://learnpress.test/wp-content/uploads/2023/07/4831876143_be927a496c_o.jpeg 2048w, https://learnpress.test/wp-content/uploads/2023/07/4831876143_be927a496c_o-300x235.jpeg 300w, https://learnpress.test/wp-content/uploads/2023/07/4831876143_be927a496c_o-1024x803.jpeg 1024w, https://learnpress.test/wp-content/uploads/2023/07/4831876143_be927a496c_o-768x602.jpeg 768w, https://learnpress.test/wp-content/uploads/2023/07/4831876143_be927a496c_o-1536x1204.jpeg 1536w" sizes="(max-width: 2048px) 100vw, 2048px">
```

The srcset attribute contains a list of all the different versions of the image that WordPress has generated. The browser will then use this information to determine which image to load based on the device it is being viewed on. No more server side logic is required, thereby speeding up page request times. And because the images are served statically, they can be cached by the browser, further speeding up page load times.

## New functions and hooks

WordPress 4.4 introduced a number of new functions and hooks to make it easier to work with responsive images.

 - wp_get_attachment_image_srcset() – Retrieves the value for an image attachment’s srcset attribute.
 - wp_calculate_image_srcset() – A helper function to calculate the image sources to include in a srcset attribute.
 - wp_get_attachment_image_sizes() – Creates a sizes attribute value for an image.
 - wp_calculate_image_sizes() – A helper function to create the sizes attribute for an image.
 - wp_image_add_srcset_and_sizes() – Adds srcset and sizes attributes to an existing img element.

As a safeguard against adding very large images to srcset attributes, a `max_srcset_image_width` filter has been added, which allows themes to set a maximum image width for images include in source set lists. The default value is 2048px.

## Customizing the responsive images markup

To modify the default srcset and sizes attributes, you should use the wp_calculate_image_srcset and wp_calculate_image_sizes filters, respectively.

Overriding the srcset or sizes attributes for images not embedded in post content (e.g. post thumbnails, galleries, etc.), can be accomplished using the wp_get_attachment_image_attributes filter, similar to how other image attributes are modified.

Additionally, you can create your own custom markup patterns by using wp_get_attachment_image_srcset() directly in your templates. Here is an example of how you could use this function to build an <img> element with a custom sizes attribute for a classic theme: 

```php
function twentytwentyone_get_responsive_image( $attachment_id ) {
	$img_src    = wp_get_attachment_image_url( $attachment_id, 'medium' );
	$img_srcset = wp_get_attachment_image_srcset( $attachment_id, 'medium' );
	return '<img src="' . $img_src . '" srcset="' . $img_srcset . '" sizes="(max-width: 50em) 87vw, 680px" alt="Our responsive image">';
}
```

Then, you can call this function in your template files, for example, in your footer template somewhere.

```php
echo twentytwentyone_get_responsive_image( 22 );
``
```

This is perfect if you're adding images to classic themes. Block themes will handle responsive images and srcset attributes automatically.

You can see this by adding an image from the media library to a template file. 

Once the image is added, and you view it on the frond end, you'll see the HTML rendered contains the relevant attributes.

Note that this does mean the image will need to be part of the media library, and not shipped with the theme. 

This is another reason to ship template images that are placeholders and then allow users to replace these images with their own, as this will automatically include the responsive images' markup.

Happy coding